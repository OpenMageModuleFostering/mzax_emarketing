/*TODO*/

window.mzax=window.mzax||{},function(a,b){function c(a){var b=a.getAttribute("data-tabId");return b||(b=a.id),b}b.ui=b.ui||{},b.disable=function(){Element.show("loading-mask").setStyle({position:"fixed",top:0,bottom:0,left:0,right:0,background:"rgba(255,255,255,0.9)"})},b.ui.TabBar=Class.create({initialize:function(a,b){var d=this;d.list=a,d.tabs=a.childElements(),d.defaultTab=b,d.tabs.each(function(e){e.on("click",function(a){d.tabClick(this)}),c(e)==b&&(a.addClassName(b),e.addClassName("active"))}),this.on=a.on.bind(a),this.observe=a.observe.bind(a),this.fire=a.fire.bind(a)},tabClick:function(a){var b=c(a);this.list.removeClassName(this.activeTab),this.activeTab=b,this.list.addClassName(b),this.tabs.each(function(a){Element.removeClassName(a,"active")}),a.addClassName("active"),this.fire("tabbar:click",{tabbar:this,tab:a,tabId:b})}}),b.ui.FrameStack=Class.create({initialize:function(a,b){var c=this;c.container=b,c.tabBar=a,c.stacks=b.childElements(),c.stacks.each(function(a){a.hide()
}),a.on("tabbar:click",function(a){c.show(a.memo.tabId+"_content")}),a.defaultTab&&c.show(a.defaultTab+"_content")},hideAll:function(){this.stacks.each(function(a){a.hide()})},show:function(a){this.hideAll();var b=this.container.down("#"+a);b&&b.show()}})}(window,window.mzax),function(a,b){function c(a){return[a[h],a[f],a[g],a[i]].join("_")}function d(a){var b=c(a);return!!j[b]&&j[b]}function e(a,b){return j[c(a)]=b,b}b.report={};var f="metrics",g="variations",h="dimension",i="time_unit",j={};b.report.clearCache=function(){j={}},b.report.ChartBlock=Class.create({initialize:function(a,b){this.url=a||"",this.params=b||{}},setData:function(a,b){return this.data=new google.visualization.DataTable(a),e(b||this.params,this.data),this},setOptions:function(a){return this.options=a||{},this},init:function(b){function c(a){var b=a.getAttribute("data-tabId"),c=a.getAttribute("data-metric");f.removeClassName(e),e=b,f.addClassName(b),g.each(function(a){Element.removeClassName(a,"active")}),
a.addClassName("active"),d.load(c)}var d=this;d.div=b,d._varcb=b.down("input.variation-checkbox"),d._tu_sel=b.down("select.time_unit"),d._varsel=b.down("select.variations"),d._cdiv=b.down("div.chart"),d.chart=new d.chartClass(d._cdiv),d.altChart=!!d.altChartClass&&new d.altChartClass(d._cdiv);var e,f=b.down("ul.option-tabs"),g=f.childElements();g.length&&(g[0].addClassName("active"),f.addClassName(g[0].getAttribute("data-tabId"))),g.each(function(a){a.on("click",function(a){c(this)})}),d._varcb&&d._varcb.on("click",function(){d.load()}),d._tu_sel&&d._tu_sel.on("change",function(){d.load()}),d._varsel&&d._varsel.on("change",function(){d.load()}),b.select(".drop-arrow").each(function(a){var b,c=a.up(".tab"),d=c.down(".metric-options");a.on("click",function(a){d.show(),a.stop()}),c.on("mouseenter",function(a){clearTimeout(b)}),c.on("mouseleave",function(a){b=d.hide.bind(d).delay(.5)}),d.select(".option").each(function(a){a.on("click",function(e){var f=a.getAttribute("data-metric")
;c.down(".title").innerHTML=a.innerHTML.strip().stripTags(),c.setAttribute("data-metric",f),d.hide(),clearTimeout(b)})})});var h=d.draw.bind(d);Event.observe(a,"resize",h),Event.observe(a,"dom:loaded",h),setTimeout(h,10)},load:function(a){var b,c=this,e=this.params;if(a&&(e[f]=[a]),c._varcb&&(e[g]=!!c._varcb.checked),c._tu_sel&&(e[i]=c._tu_sel.value),c._varsel){var h=c._varsel.value;h!=-1&&(e[g]=h)}return(b=d(e))?(c.data=b,c.draw()):(e.c=Math.random(),c.div.addClassName("loading"),new Ajax.Request(c.url,{postBody:Object.toJSON(e),evalJSON:!0,contentType:"application/json",onComplete:function(a){c.setData(a.responseJSON,e),c.div.removeClassName("loading"),c.draw()}.bind(this)}),c)},draw:function(){try{var a=this,b=a.options,c=a.data,d=a.params;if(!c||!d||!b)return this;if(!c.getNumberOfColumns()||!c.getNumberOfRows())return a.div.down(".no-data").show(),a._cdiv.hide(),this;switch(a.div.down(".no-data").hide(),a._cdiv.show(),c.getTableProperty("timeunit")){case"days":
b.bar.groupWidth="100%";break;case"weeks":default:b.bar.groupWidth="90%"}c.getColumnId(1).match(/_rate/)&&(b.vAxis.format="percent"),c.getColumnId(1).match(/_revenue/)?b.vAxis.format="currency":b.vAxis.format="#,###",c.getTableProperty("dye")?(b.legend.alignment="start",b.legend.position="right"):(b.legend.alignment="end",d[g]?b.legend.position="in":b.legend.position="none"),b.isStacked=!!c.getTableProperty("stacked"),b.colors=a.getSeriesColors(),a.chart.draw(a.data,b)}catch(a){console}return a},getSeriesColors:function(){var a=[],b=this.data,c=b.getNumberOfColumns();if(b.getTableProperty("dye"))for(c=b.getNumberOfRows();--c>-1;)a.unshift(b.getRowProperty(c,"color")||null);else for(;--c>0;)a.unshift(b.getColumnProperty(c,"color")||null);return a}}),b.report.GeoChartBlock=Class.create(b.report.ChartBlock,{init:function(a,b){function c(a){a.region.match("^[A-Z]{2}$")&&d.loadRegion(a.region)}a(b);var d=this;d._brcm=b.down(".breadcrumbs"),d._brcm.on("click",function(){d.loadRegion(null)}),
google.visualization.events.addListener(d.chart,"regionClick",c)},loadRegion:function(a){var b=this.params,c=this.options;b[h]=a?"region":"country",c.region=a||"world",c.resolution=a?"provinces":null,this._brcm.down(".region").innerHTML=a||"",this._brcm.down(".region").toggle(!!a),this.load()},draw:function(){var b=this;if(!b.data.getNumberOfColumns()||!b.data.getNumberOfRows())return b.div.down(".no-data").show(),b._cdiv.hide(),this;b.div.down(".no-data").hide(),b._cdiv.show();try{var c=this.options;c.datalessRegionColor="ddd",c.colorAxis={colors:this.data.getColumnProperty(1,"color_axis")},c.height=Math.max(Math.min(a.innerHeight-150,800),200),this.chart.draw(this.data,c)}catch(a){console}}})}(window,mzax);